name: Features
description: 'Some'
branding:
  icon: 'chevrons-up'  
  color: 'green'

runs:
  using: "composite"
  steps:
    - name: GET ENV
      shell: bash
      run: |
        echo "TESTBOX_BRANCH_PLATFORM=${{ env.TESTBOX_BRANCH_PLATFORM }}" 
        echo "ANVIL_NUMBER=${{ env.ANVIL_NUMBER }}"
    - name: Check Always
      env: 
        GITHUB_CONTEXT: ${{ toJSON(github) }}
      shell: bash
      if: always()
      run: |
        base_url='https://console.cloud.google.com/logs/query'
        url_params="query=resource.labels.namespace_name%3D~%22$github-features-staff-portal-15120-1%22%0Aresource.type%3D%22k8s_container%22%0Aresource.labels.cluster_name%3D%22testbox%22"

        # url_params="query=resource.labels.namespace_name%3D~%22github-features-staff-portal-15120-1%22"
        time_range="timeRange=$(date --utc +%FT%TZ -d '30 minutes ago')%2F$(date --utc +%FT%TZ -d '+2 hour')"
        logs_link="${base_url};${url_params};${time_range}?project=toptal-ci"
        echo -e "\e[44mGoogle Logs: ${logs_link}\e[0m"
        echo "GOOGLE_LOGS_LINK=${logs_link}" >> $GITHUB_ENV
        echo ${{ env.GITHUB_CONTEXT}}
        
        
        time_range="timeRange=$(date --utc +%FT%TZ -d \"${{github.event.commits.timestamp}}\")"
        echo $time_range
        
    - name: Print link
      shell: bash
      run: |
        echo -e "\e[44mGoogle Logs: ${{ env.GOOGLE_LOGS_LINK }}\e[0m"
